---
import pkg from '../../../package.json';

const currentPath = Astro.url.pathname;

const navLinks = [
  { href: '/install', label: 'Install' },
  { href: '/features', label: 'Features' },
  { href: '/demo', label: 'Demo' },
  { href: '/how-it-works', label: 'How It Works' },
];

function isActive(href: string) {
  // Normalize trailing slashes for comparison
  const normalized = currentPath.replace(/\/$/, '') || '/';
  return normalized === href;
}
---

<nav class="fixed top-4 z-50 nav-glass" transition:persist>
  <div class="w-full px-6 py-3">
    <div class="flex items-center justify-between">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-3 !p-0 logo-link">
        <div class="w-8 h-8 rounded-lg overflow-hidden flex items-center justify-center">
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_logo)">
              <path d="M25.75 0H6.25C2.79822 0 0 2.79822 0 6.25V25.75C0 29.2018 2.79822 32 6.25 32H25.75C29.2018 32 32 29.2018 32 25.75V6.25C32 2.79822 29.2018 0 25.75 0Z" fill="#262626"/>
              <g clip-path="url(#clip1_logo)">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M19.5538 6.69535C19.0883 6.24225 18.4643 5.98873 17.8146 5.98873C17.165 5.98873 16.541 6.24225 16.0754 6.69535L6.80039 15.7912C6.64518 15.942 6.43727 16.0264 6.22082 16.0264C6.00438 16.0264 5.79646 15.942 5.64125 15.7912C5.56526 15.7173 5.50486 15.6289 5.46362 15.5313C5.42237 15.4336 5.40112 15.3287 5.40112 15.2227C5.40112 15.1167 5.42237 15.0118 5.46362 14.9141C5.50486 14.8165 5.56526 14.7281 5.64125 14.6542L14.9163 5.55837C15.6922 4.80333 16.732 4.38086 17.8146 4.38086C18.8972 4.38086 19.9371 4.80333 20.713 5.55837C21.1619 5.99495 21.5011 6.53164 21.7027 7.1245C21.9043 7.71736 21.9627 8.34954 21.8731 8.9693C22.5011 8.87999 23.1412 8.93605 23.7441 9.13318C24.347 9.3303 24.8966 9.66322 25.3505 10.1063L25.3987 10.1545C25.7786 10.524 26.0806 10.9659 26.2868 11.4541C26.4931 11.9423 26.5993 12.4669 26.5993 12.9969C26.5993 13.5269 26.4931 14.0515 26.2868 14.5397C26.0806 15.0279 25.7786 15.4699 25.3987 15.8394L17.0101 24.0651C16.9848 24.0897 16.9646 24.1192 16.9509 24.1517C16.9371 24.1842 16.9301 24.2191 16.9301 24.2544C16.9301 24.2898 16.9371 24.3247 16.9509 24.3572C16.9646 24.3897 16.9848 24.4192 17.0101 24.4438L18.7329 26.1338C18.8089 26.2077 18.8693 26.2961 18.9105 26.3938C18.9518 26.4914 18.973 26.5963 18.973 26.7023C18.973 26.8083 18.9518 26.9132 18.9105 27.0109C18.8693 27.1085 18.8089 27.1969 18.7329 27.2708C18.5777 27.4217 18.3698 27.5061 18.1533 27.5061C17.9369 27.5061 17.729 27.4217 17.5738 27.2708L15.8509 25.5817C15.6735 25.4093 15.5324 25.203 15.4361 24.9751C15.3398 24.7472 15.2902 24.5023 15.2902 24.2549C15.2902 24.0075 15.3398 23.7626 15.4361 23.5347C15.5324 23.3068 15.6735 23.1006 15.8509 22.9281L24.2395 14.7014C24.4674 14.4796 24.6485 14.2145 24.7721 13.9216C24.8958 13.6286 24.9595 13.3139 24.9595 12.9959C24.9595 12.678 24.8958 12.3633 24.7721 12.0703C24.6485 11.7774 24.4674 11.5122 24.2395 11.2905L24.1914 11.2433C23.7263 10.7906 23.1031 10.5371 22.4542 10.5366C21.8053 10.5361 21.1817 10.7886 20.716 11.2405L12.3274 19.4662C12.3021 19.4908 12.2819 19.5203 12.2681 19.5528C12.2544 19.5853 12.2474 19.6202 12.2474 19.6555C12.2474 19.6909 12.2544 19.7258 12.2681 19.7583C12.2819 19.7908 12.3021 19.8203 12.3274 19.8449L13.063 20.5651C13.139 20.639 13.1994 20.7274 13.2407 20.825C13.2819 20.9227 13.3031 21.0276 13.3031 21.1336C13.3031 21.2396 13.2819 21.3445 13.2407 21.4422C13.1994 21.5398 13.139 21.6282 13.063 21.7021C12.9078 21.853 12.6997 21.9374 12.4831 21.9374C12.2664 21.9374 12.0583 21.853 11.9031 21.7021L11.1675 20.9819C10.99 20.8095 10.8489 20.6032 10.7526 20.3753C10.6563 20.1474 10.6067 19.9025 10.6067 19.6551C10.6067 19.4077 10.6563 19.1628 10.7526 18.935C10.8489 18.7071 10.99 18.5008 11.1675 18.3284L19.557 10.1026C20.3329 9.34762 21.3728 8.92515 22.4553 8.92515C23.5378 8.92515 24.5777 9.34762 25.3536 10.1026" fill="#9064EA"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M18.3945 8.96889C18.4705 8.89499 18.5309 8.80661 18.5722 8.70897C18.6134 8.61132 18.6346 8.5064 18.6346 8.4004C18.6346 8.29441 18.6134 8.18949 18.5722 8.09184C18.5309 7.9942 18.4705 7.90582 18.3945 7.83192C18.2393 7.68077 18.0311 7.59619 17.8145 7.59619C17.5978 7.59619 17.3897 7.68077 17.2344 7.83192L10.375 14.5594C9.99502 14.9289 9.69301 15.3708 9.48679 15.859C9.28057 16.3472 9.17432 16.8718 9.17432 17.4018C9.17432 17.9318 9.28057 18.4564 9.48679 18.9446C9.69301 19.4328 9.99502 19.8748 10.375 20.2443C11.1509 20.9991 12.1908 21.4214 13.2733 21.4214C14.3558 21.4214 15.3957 20.9991 16.1716 20.2443L23.032 13.5168C23.108 13.4429 23.1684 13.3545 23.2097 13.2569C23.2509 13.1592 23.2722 13.0543 23.2722 12.9483C23.2722 12.8423 23.2509 12.7374 23.2097 12.6398C23.1684 12.5421 23.108 12.4537 23.032 12.3798C22.8768 12.2287 22.6687 12.1441 22.452 12.1441C22.2353 12.1441 22.0272 12.2287 21.8719 12.3798L15.0125 19.1073C14.5469 19.5604 13.9229 19.8139 13.2733 19.8139C12.6237 19.8139 11.9997 19.5604 11.5341 19.1073C11.3063 18.8855 11.1252 18.6203 11.0015 18.3274C10.8778 18.0345 10.8141 17.7198 10.8141 17.4018C10.8141 17.0839 10.8778 16.7691 11.0015 16.4762C11.1252 16.1833 11.3063 15.9181 11.5341 15.6963L18.3945 8.96889Z" fill="#9064EA"/>
              </g>
            </g>
            <defs>
              <clipPath id="clip0_logo">
                <rect width="32" height="32" fill="white"/>
              </clipPath>
              <clipPath id="clip1_logo">
                <rect width="23.125" height="23.125" fill="white" transform="translate(4.4375 4.4375)"/>
              </clipPath>
            </defs>
          </svg>
        </div>
        <span class="text-xl font-bold text-foreground">MCP-Obsidian</span>
        <span class="hidden sm:inline-flex items-center px-1.5 py-0.5 rounded-full text-[10px] font-medium bg-accent/20 text-white border border-accent/30 leading-tight">v{pkg.version}</span>
      </a>

      <!-- Navigation links -->
      <div class="hidden md:flex items-center gap-8">
        {navLinks.map(link => (
          <a
            href={link.href}
            class:list={['nav-link', { 'nav-link-active': isActive(link.href) }]}
          >
            {link.label}
          </a>
        ))}
        <a href="https://github.com/bitbonsai/mcp-obsidian" target="_blank" rel="noopener noreferrer" class="nav-link inline-flex items-center gap-1.5">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
          GitHub
        </a>
      </div>

      <!-- Mobile menu button -->
      <button class="md:hidden nav-link p-2" id="mobile-menu-button" aria-label="Toggle mobile menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile menu dropdown -->
  <div class="md:hidden mobile-menu hidden fixed top-[80px] left-0 right-0 bottom-0 z-[9998]" id="mobile-menu">
    <div class="p-8 space-y-6 h-auto" style="background: rgba(0, 0, 0, 0.85);">
      {navLinks.map(link => (
        <a
          href={link.href}
          class:list={['block nav-link text-center text-lg', { 'nav-link-active': isActive(link.href) }]}
        >
          {link.label}
        </a>
      ))}
      <a href="https://github.com/bitbonsai/mcp-obsidian" target="_blank" rel="noopener noreferrer" class="nav-link text-center text-lg flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        GitHub
      </a>
    </div>
  </div>
</nav>

<script>
  function updateActiveNav() {
    const currentPath = window.location.pathname.replace(/\/$/, '') || '/';
    const navLinks = document.querySelectorAll('nav a[href^="/"]');
    navLinks.forEach(link => {
      const href = link.getAttribute('href');
      if (!href || href === '/') return;
      if (currentPath === href) {
        link.classList.add('nav-link-active');
      } else {
        link.classList.remove('nav-link-active');
      }
    });
  }

  document.addEventListener('astro:page-load', function() {
    updateActiveNav();

    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');

    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.addEventListener('click', function() {
        requestAnimationFrame(() => {
          mobileMenu.classList.toggle('hidden');
        });
      });

      const menuLinks = mobileMenu.querySelectorAll('a');
      menuLinks.forEach(link => {
        link.addEventListener('click', function() {
          requestAnimationFrame(() => {
            mobileMenu.classList.add('hidden');
          });
        });
      });

      document.addEventListener('click', function(event) {
        if (!mobileMenuButton.contains(event.target as Node) && !mobileMenu.contains(event.target as Node)) {
          requestAnimationFrame(() => {
            mobileMenu.classList.add('hidden');
          });
        }
      });
    }
  });
</script>

<style>
  /* Floating dark glass navigation */
  .nav-glass {
    background: rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.3),
      0 2px 8px rgba(0, 0, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    position: fixed;
    width: calc(100vw - 2rem);
    max-width: 1152px;
    left: 50%;
    transform: translateX(-50%);
  }

  .nav-glass::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.05) 0%,
      rgba(255, 255, 255, 0.02) 50%,
      rgba(255, 255, 255, 0.01) 100%
    );
    border-radius: 16px;
    pointer-events: none;
    z-index: -1;
  }

  /* Navigation link glow effects */
  .nav-link {
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
    padding: 8px 16px;
    border-radius: 8px;
    transition: all 0.3s ease;
    position: relative;
    font-weight: 500;
  }

  .nav-link:hover {
    color: rgba(255, 255, 255, 1);
    text-shadow: 0 0 8px rgba(139, 92, 246, 0.6);
    box-shadow:
      0 0 20px rgba(139, 92, 246, 0.3),
      inset 0 0 20px rgba(139, 92, 246, 0.1);
    background: rgba(139, 92, 246, 0.1);
    transform: translateY(-1px);
  }

  .nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent, rgba(139, 92, 246, 0.1), transparent);
    border-radius: 8px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .nav-link:hover::before {
    opacity: 1;
  }

  /* Logo link - subtle white glow on hover */
  .logo-link {
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .logo-link:hover span {
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
  }

  /* Active link state */
  .nav-link-active {
    color: rgba(255, 255, 255, 1);
    background: rgba(139, 92, 246, 0.15);
    text-shadow: 0 0 6px rgba(139, 92, 246, 0.4);
  }

  /* Navigation z-index */
  nav {
    z-index: 9999;
  }

  @media (max-width: 768px) {
    .nav-glass {
      top: 8px;
      border-radius: 12px;
      width: calc(100vw - 1rem);
      max-width: none;
    }

    .mobile-menu {
      animation: slideDown 0.3s ease-out;
      background: rgba(0, 0, 0, 0.85) !important;
      backdrop-filter: blur(40px) !important;
      -webkit-backdrop-filter: blur(40px) !important;
    }
  }

  @media (max-width: 480px) {
    .nav-glass {
      width: calc(100vw - 0.5rem);
      top: 4px;
    }
  }

  /* Mobile menu animations */
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .mobile-menu.hidden {
    display: none;
  }
</style>
