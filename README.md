<div align="center">
  <svg width="64" height="64" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_logo)">
      <path d="M25.75 0H6.25C2.79822 0 0 2.79822 0 6.25V25.75C0 29.2018 2.79822 32 6.25 32H25.75C29.2018 32 32 29.2018 32 25.75V6.25C32 2.79822 29.2018 0 25.75 0Z" fill="#262626"></path>
      <g clip-path="url(#clip1_logo)">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M19.5538 6.69535C19.0883 6.24225 18.4643 5.98873 17.8146 5.98873C17.165 5.98873 16.541 6.24225 16.0754 6.69535L6.80039 15.7912C6.64518 15.942 6.43727 16.0264 6.22082 16.0264C6.00438 16.0264 5.79646 15.942 5.64125 15.7912C5.56526 15.7173 5.50486 15.6289 5.46362 15.5313C5.42237 15.4336 5.40112 15.3287 5.40112 15.2227C5.40112 15.1167 5.42237 15.0118 5.46362 14.9141C5.50486 14.8165 5.56526 14.7281 5.64125 14.6542L14.9163 5.55837C15.6922 4.80333 16.732 4.38086 17.8146 4.38086C18.8972 4.38086 19.9371 4.80333 20.713 5.55837C21.1619 5.99495 21.5011 6.53164 21.7027 7.1245C21.9043 7.71736 21.9627 8.34954 21.8731 8.9693C22.5011 8.87999 23.1412 8.93605 23.7441 9.13318C24.347 9.3303 24.8966 9.66322 25.3505 10.1063L25.3987 10.1545C25.7786 10.524 26.0806 10.9659 26.2868 11.4541C26.4931 11.9423 26.5993 12.4669 26.5993 12.9969C26.5993 13.5269 26.4931 14.0515 26.2868 14.5397C26.0806 15.0279 25.7786 15.4699 25.3987 15.8394L17.0101 24.0651C16.9848 24.0897 16.9646 24.1192 16.9509 24.1517C16.9371 24.1842 16.9301 24.2191 16.9301 24.2544C16.9301 24.2898 16.9371 24.3247 16.9509 24.3572C16.9646 24.3897 16.9848 24.4192 17.0101 24.4438L18.7329 26.1338C18.8089 26.2077 18.8693 26.2961 18.9105 26.3938C18.9518 26.4914 18.973 26.5963 18.973 26.7023C18.973 26.8083 18.9518 26.9132 18.9105 27.0109C18.8693 27.1085 18.8089 27.1969 18.7329 27.2708C18.5777 27.4217 18.3698 27.5061 18.1533 27.5061C17.9369 27.5061 17.729 27.4217 17.5738 27.2708L15.8509 25.5817C15.6735 25.4093 15.5324 25.203 15.4361 24.9751C15.3398 24.7472 15.2902 24.5023 15.2902 24.2549C15.2902 24.0075 15.3398 23.7626 15.4361 23.5347C15.5324 23.3068 15.6735 23.1006 15.8509 22.9281L24.2395 14.7014C24.4674 14.4796 24.6485 14.2145 24.7721 13.9216C24.8958 13.6286 24.9595 13.3139 24.9595 12.9959C24.9595 12.678 24.8958 12.3633 24.7721 12.0703C24.6485 11.7774 24.4674 11.5122 24.2395 11.2905L24.1914 11.2433C23.7263 10.7906 23.1031 10.5371 22.4542 10.5366C21.8053 10.5361 21.1817 10.7885 20.7159 11.2404L13.8053 18.0179L13.8034 18.0199L13.709 18.1133C13.5537 18.2645 13.3456 18.349 13.1289 18.349C12.9123 18.349 12.7041 18.2645 12.5489 18.1133C12.4729 18.0394 12.4125 17.951 12.3712 17.8534C12.33 17.7557 12.3088 17.6508 12.3088 17.5448C12.3088 17.4388 12.33 17.3339 12.3712 17.2363C12.4125 17.1386 12.4729 17.0502 12.5489 16.9763L19.5567 10.1034C19.7839 9.88148 19.9644 9.61633 20.0876 9.32357C20.2107 9.03081 20.274 8.71636 20.2738 8.39876C20.2735 8.08115 20.2097 7.76682 20.086 7.47427C19.9624 7.18172 19.7814 6.91687 19.5538 6.69535Z" fill="#9064EA"></path>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M18.3945 8.96889C18.4705 8.89499 18.5309 8.80661 18.5722 8.70897C18.6134 8.61132 18.6346 8.5064 18.6346 8.4004C18.6346 8.29441 18.6134 8.18949 18.5722 8.09184C18.5309 7.9942 18.4705 7.90582 18.3945 7.83192C18.2393 7.68077 18.0311 7.59619 17.8145 7.59619C17.5978 7.59619 17.3897 7.68077 17.2344 7.83192L10.375 14.5594C9.99502 14.9289 9.69301 15.3708 9.48679 15.859C9.28057 16.3472 9.17432 16.8718 9.17432 17.4018C9.17432 17.9318 9.28057 18.4564 9.48679 18.9446C9.69301 19.4328 9.99502 19.8748 10.375 20.2443C11.1509 20.9991 12.1908 21.4214 13.2733 21.4214C14.3558 21.4214 15.3957 20.9991 16.1716 20.2443L23.032 13.5168C23.108 13.4429 23.1684 13.3545 23.2097 13.2569C23.2509 13.1592 23.2722 13.0543 23.2722 12.9483C23.2722 12.8423 23.2509 12.7374 23.2097 12.6398C23.1684 12.5421 23.108 12.4537 23.032 12.3798C22.8768 12.2287 22.6687 12.1441 22.452 12.1441C22.2353 12.1441 22.0272 12.2287 21.8719 12.3798L15.0125 19.1073C14.5469 19.5604 13.9229 19.8139 13.2733 19.8139C12.6237 19.8139 11.9997 19.5604 11.5341 19.1073C11.3063 18.8855 11.1252 18.6203 11.0015 18.3274C10.8778 18.0345 10.8141 17.7198 10.8141 17.4018C10.8141 17.0839 10.8778 16.7691 11.0015 16.4762C11.1252 16.1833 11.3063 15.9181 11.5341 15.6963L18.3945 8.96889Z" fill="#9064EA"></path>
      </g>
    </g>
    <defs>
      <clipPath id="clip0_logo">
        <rect width="32" height="32" fill="white"></rect>
      </clipPath>
      <clipPath id="clip1_logo">
        <rect width="23.125" height="23.125" fill="white" transform="translate(4.4375 4.4375)"></rect>
      </clipPath>
    </defs>
  </svg>
</div>

# MCP-Obsidian

A lightweight Model Context Protocol (MCP) server for safe Obsidian vault access. This server provides AI assistants with the ability to read and write notes in an Obsidian vault while preventing YAML frontmatter corruption.

**Supported AI Platforms:** Claude Desktop, Claude Code, ChatGPT Desktop (Enterprise+), IntelliJ IDEA 2025.1+, Cursor IDE, and other MCP-compatible clients.

## Demo Video

<video width="800" autoplay loop muted controls>
  <source src="https://mcp-obsidian.org/mcp-obsidian-1-min.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>

*Watch the MCP-Obsidian server in action: configuring Claude Desktop, connecting to an Obsidian vault, and performing note operations through natural language commands.*

## Quick Start (5 minutes)

1. **Install Node.js runtime:**
   ```bash
   # Download from https://nodejs.org (v18.0.0 or later)
   # or use a package manager like nvm, brew, apt, etc.
   ```

2. **Test the server:**

   If using the published package:
   ```bash
   npx @modelcontextprotocol/inspector npx @mauricio.wolff/mcp-obsidian@latest /path/to/your/vault
   ```

3. **Configure your AI client:**

   **Claude Desktop** - Copy this to `claude_desktop_config.json`:
   ```json
   {
     "mcpServers": {
       "obsidian": {
         "command": "npx",
         "args": ["@mauricio.wolff/mcp-obsidian@latest", "/path/to/your/vault"]
       }
     }
   }
   ```

   **Claude Code** - Copy this to `~/.claude.json`:
   ```json
   {
     "mcpServers": {
       "obsidian": {
         "command": "npx",
         "args": ["@mauricio.wolff/mcp-obsidian@latest", "/path/to/your/vault"],
         "env": {}
       }
     }
   }
   ```

   Replace `/path/to/your/vault` with your actual Obsidian vault path.

   For other platforms, see [detailed configuration guides](#ai-client-configuration) below.

4. **Test with your AI:**
   - "List files in my Obsidian vault"
   - "Read my note called 'project-ideas.md'"
   - "Create a new note with today's date"

**Success indicators:** Your AI should be able to list files and read notes from your vault.

## Features

- ✅ Safe frontmatter parsing and validation using gray-matter
- ✅ Path filtering to exclude `.obsidian` directory and other system files
- ✅ **Complete MCP toolkit**: 11 methods covering all vault operations
  - File operations: `read_note`, `write_note`, `delete_note`, `move_note`
  - Directory operations: `list_directory`
  - Batch operations: `read_multiple_notes`
  - Search: `search_notes` with content and frontmatter support
  - Metadata: `get_frontmatter`, `update_frontmatter`, `get_notes_info`
  - Tag management: `manage_tags` (add, remove, list)
- ✅ **NEW:** Write modes: `overwrite`, `append`, `prepend` for flexible content editing
- ✅ **NEW:** Tag management: add, remove, and list tags in notes
- ✅ Safe deletion with confirmation requirement to prevent accidents
- ✅ Automatic path trimming to handle whitespace in inputs
- ✅ TypeScript support with Node.js runtime (using tsx for execution)
- ✅ Comprehensive error handling and validation

## Prerequisites

- [Node.js](https://nodejs.org) runtime (v18.0.0 or later)
- An Obsidian vault (local directory with `.md` files)
- MCP-compatible AI client (Claude Desktop, ChatGPT Desktop, Claude Code, etc.)

## Installation

### For End Users (Recommended)

No installation needed! Use `npx` to run directly:

```bash
npx @mauricio.wolff/mcp-obsidian@latest /path/to/your/obsidian/vault
```

### For Developers

1. Clone this repository
2. Install dependencies with npm:
```bash
npm install
```

3. Test locally with MCP inspector:
```bash
npx @modelcontextprotocol/inspector npm start /path/to/your/vault
```

## Usage

### Running the Server

**End users:**
```bash
npx @mauricio.wolff/mcp-obsidian@latest /path/to/your/obsidian/vault
```

**Developers:**
```bash
npm start /path/to/your/obsidian/vault
```

### AI Client Configuration

#### Claude Desktop

Add to your Claude Desktop configuration file:

**Single Vault:**
```json
{
  "mcpServers": {
    "obsidian": {
      "command": "npx",
      "args": ["@mauricio.wolff/mcp-obsidian@latest", "/Users/yourname/Documents/MyVault"]
    }
  }
}
```

**Multiple Vaults:**
```json
{
  "mcpServers": {
    "obsidian-personal": {
      "command": "npx",
      "args": ["@mauricio.wolff/mcp-obsidian@latest", "/Users/yourname/Documents/PersonalVault"]
    },
    "obsidian-work": {
      "command": "npx",
      "args": ["@mauricio.wolff/mcp-obsidian@latest", "/Users/yourname/Documents/WorkVault"]
    }
  }
}
```

**Configuration File Locations:**
- **macOS:** `~/Library/Application Support/Claude/claude_desktop_config.json`
- **Windows:** `C:\Users\{username}\AppData\Roaming\Claude\claude_desktop_config.json`
- **Linux:** `~/.config/Claude/claude_desktop_config.json`

*You can also access this through Claude Desktop → Settings → Developer → Edit Config*

#### ChatGPT Desktop

**Requirements:** ChatGPT Enterprise, Education, or Team subscription (not available for individual Plus users)

ChatGPT uses MCP through Deep Research and developer mode. Configuration is done through the ChatGPT interface:

1. Access ChatGPT developer mode (beta feature)
2. Configure MCP servers through the built-in MCP client
3. Create custom connectors for your organization

*Note: ChatGPT Desktop's MCP integration is currently limited to enterprise subscriptions and uses a different setup process than file-based configuration.*

#### Claude Code

Claude Code uses `.claude.json` configuration file:

**User-scoped (recommended):**
Edit `~/.claude.json`:
```json
{
  "mcpServers": {
    "obsidian": {
      "command": "npx",
      "args": ["@mauricio.wolff/mcp-obsidian@latest", "/path/to/your/vault"],
      "env": {}
    }
  }
}
```

**Project-scoped:**
Edit `.claude.json` in your project or add to the projects section:
```json
{
  "projects": {
    "/path/to/your/project": {
      "mcpServers": {
        "obsidian": {
          "command": "npx",
          "args": ["@mauricio.wolff/mcp-obsidian@latest", "/path/to/your/vault"]
        }
      }
    }
  }
}
```

**Using Claude Code CLI:**
```bash
claude mcp add obsidian --scope user npx @mauricio.wolff/mcp-obsidian /path/to/your/vault
```

#### Other MCP-Compatible Clients (2025)

**Confirmed MCP Support:**
- **IntelliJ IDEA 2025.1+** - Native MCP client support
- **Cursor IDE** - Built-in MCP compatibility
- **Zed, Replit, Codeium, Sourcegraph** - In development
- **Microsoft Copilot Studio** - Native MCP support with one-click server connections

Most modern MCP clients use similar JSON configuration patterns. Refer to your specific client's documentation for exact setup instructions.

### Examples

#### Ask your AI assistant about your notes:
- "What files are in my Obsidian vault?"
- "Read my note called 'project-ideas.md'"
- "Show me all notes with 'AI' in the title"

#### Have your AI assistant help with note management:
- "Create a new note called 'meeting-notes.md' with today's date in the frontmatter"
- "Append today's journal entry to my daily note"
- "Prepend an urgent task to my todo list"
- "Add the tags 'project' and 'urgent' to my task note"
- "List all tags in my research note"
- "Remove the 'draft' tag from my completed article"
- "List all markdown files in my 'Projects' folder"
- "Delete the old draft note 'draft-ideas.md' (with confirmation)"

## Troubleshooting

### Common Issues

#### "command not found: npx"
- **Solution:** Install Node.js runtime from [nodejs.org](https://nodejs.org)
- **Alternative:** Use global install: `npm install -g @mauricio.wolff/mcp-obsidian`

#### "Usage: node server.ts /path/to/vault"
- **Cause:** No vault path provided
- **Solution:** Specify the full path to your Obsidian vault directory

#### "Permission denied" errors
- **Cause:** Insufficient file system permissions
- **Solution:** Ensure the vault directory is readable/writable by your user

#### "Path traversal not allowed"
- **Cause:** Trying to access files outside the vault
- **Solution:** All file paths must be relative to the vault root

#### AI client not recognizing the server
1. Check the configuration file path is correct for your OS
2. Ensure JSON syntax is valid (use a JSON validator)
3. Restart your AI client after configuration changes
4. Check your AI client's logs for error messages
5. Verify your AI client supports MCP (Model Context Protocol)

#### ".obsidian files still showing up"
- **Expected:** The path filter automatically excludes `.obsidian/**` patterns
- **If still seeing them:** The filter is working as designed for security

### Debug Mode

Run with error logging:
```bash
npx @mauricio.wolff/mcp-obsidian /path/to/vault 2>debug.log
```

### Getting Help

- [Open an issue](https://github.com/bitbonsai/mcp-obsidian/issues) on GitHub
- Include your OS, Node.js version, and error messages
- Provide the vault directory structure (without sensitive content)

## Testing

Run the test suite:
```bash
npm test
```

## API Methods

### `read_note`
Read a note from the vault with parsed frontmatter.

**Request:**
```json
{
  "name": "read_note",
  "arguments": {
    "path": "project-ideas.md"
  }
}
```

**Response:**
```json
{
  "path": "project-ideas.md",
  "frontmatter": {
    "title": "Project Ideas",
    "tags": ["projects", "brainstorming"],
    "created": "2023-01-15T10:30:00.000Z"
  },
  "content": "# Project Ideas\n\n## AI Tools\n- MCP server for Obsidian\n- Voice note transcription\n\n## Web Apps\n- Task management system"
}
```

### `write_note`
Write a note to the vault with optional frontmatter and write mode.

**Write Modes:**
- `overwrite` (default): Replace entire file content
- `append`: Add content to the end of existing file
- `prepend`: Add content to the beginning of existing file

**Request (Overwrite):**
```json
{
  "name": "write_note",
  "arguments": {
    "path": "meeting-notes.md",
    "content": "# Team Meeting\n\n## Agenda\n- Project updates\n- Next milestones",
    "frontmatter": {
      "title": "Team Meeting Notes",
      "date": "2023-12-01",
      "tags": ["meetings", "team"]
    },
    "mode": "overwrite"
  }
}
```

**Request (Append):**
```json
{
  "name": "write_note",
  "arguments": {
    "path": "daily-log.md",
    "content": "\n\n## 3:00 PM Update\n- Completed project review\n- Started new feature",
    "mode": "append"
  }
}
```

**Response:**
```json
{
  "message": "Successfully wrote note: meeting-notes.md (mode: overwrite)"
}
```

### `list_directory`
List files and directories in the vault.

**Request:**
```json
{
  "name": "list_directory",
  "arguments": {
    "path": "Projects"
  }
}
```

**Response:**
```json
{
  "path": "Projects",
  "directories": [
    "AI-Tools",
    "Web-Development"
  ],
  "files": [
    "project-template.md",
    "roadmap.md"
  ]
}
```

### `delete_note`
Delete a note from the vault (requires confirmation for safety).

**Request:**
```json
{
  "name": "delete_note",
  "arguments": {
    "path": "old-draft.md",
    "confirmPath": "old-draft.md"
  }
}
```

**Response (Success):**
```json
{
  "success": true,
  "path": "old-draft.md",
  "message": "Successfully deleted note: old-draft.md. This action cannot be undone."
}
```

**Response (Confirmation Failed):**
```json
{
  "success": false,
  "path": "old-draft.md",
  "message": "Deletion cancelled: confirmation path does not match. For safety, both 'path' and 'confirmPath' must be identical."
}
```

**⚠️ Safety Note:** The `confirmPath` parameter must exactly match the `path` parameter to proceed with deletion. This prevents accidental deletions.

### `get_frontmatter`
Extract only the frontmatter from a note without reading the full content.

**Request:**
```json
{
  "name": "get_frontmatter",
  "arguments": {
    "path": "project-ideas.md"
  }
}
```

**Response:**
```json
{
  "path": "project-ideas.md",
  "frontmatter": {
    "title": "Project Ideas",
    "tags": ["projects", "brainstorming"],
    "created": "2023-01-15T10:30:00.000Z"
  }
}
```

### `manage_tags`
Add, remove, or list tags in a note. Tags are managed in the frontmatter and inline tags are detected.

**Request (List Tags):**
```json
{
  "name": "manage_tags",
  "arguments": {
    "path": "research-notes.md",
    "operation": "list"
  }
}
```

**Request (Add Tags):**
```json
{
  "name": "manage_tags",
  "arguments": {
    "path": "research-notes.md",
    "operation": "add",
    "tags": ["machine-learning", "ai", "important"]
  }
}
```

**Request (Remove Tags):**
```json
{
  "name": "manage_tags",
  "arguments": {
    "path": "research-notes.md",
    "operation": "remove",
    "tags": ["draft", "temporary"]
  }
}
```

**Response:**
```json
{
  "path": "research-notes.md",
  "operation": "add",
  "tags": ["research", "ai", "machine-learning", "important"],
  "success": true,
  "message": "Successfully added tags"
}
```

### `search_notes`
Search for notes in the vault by content or frontmatter.

**Request:**
```json
{
  "name": "search_notes",
  "arguments": {
    "query": "machine learning",
    "limit": 5,
    "searchContent": true,
    "searchFrontmatter": false,
    "caseSensitive": false
  }
}
```

**Response:**
```json
{
  "query": "machine learning",
  "resultCount": 3,
  "results": [
    {
      "path": "ai-research.md",
      "title": "AI Research Notes",
      "excerpt": "...machine learning algorithms are...",
      "matchCount": 2,
      "lineNumber": 15
    }
  ]
}
```

### `move_note`
Move or rename a note in the vault.

**Request:**
```json
{
  "name": "move_note",
  "arguments": {
    "oldPath": "drafts/article.md",
    "newPath": "published/article.md",
    "overwrite": false
  }
}
```

**Response:**
```json
{
  "success": true,
  "oldPath": "drafts/article.md",
  "newPath": "published/article.md",
  "message": "Successfully moved note from drafts/article.md to published/article.md"
}
```

### `read_multiple_notes`
Read multiple notes in a batch (maximum 10 files).

**Request:**
```json
{
  "name": "read_multiple_notes",
  "arguments": {
    "paths": ["note1.md", "note2.md", "note3.md"],
    "includeContent": true,
    "includeFrontmatter": true
  }
}
```

**Response:**
```json
{
  "successful": [
    {
      "path": "note1.md",
      "frontmatter": {"title": "Note 1"},
      "content": "# Note 1\n\nContent here..."
    }
  ],
  "failed": [
    {
      "path": "note2.md",
      "error": "File not found"
    }
  ],
  "summary": {
    "successCount": 1,
    "failureCount": 1
  }
}
```

### `update_frontmatter`
Update frontmatter of a note without changing content.

**Request:**
```json
{
  "name": "update_frontmatter",
  "arguments": {
    "path": "research-note.md",
    "frontmatter": {
      "status": "completed",
      "updated": "2025-09-23"
    },
    "merge": true
  }
}
```

**Response:**
```json
{
  "message": "Successfully updated frontmatter for: research-note.md"
}
```

### `get_notes_info`
Get metadata for notes without reading full content.

**Request:**
```json
{
  "name": "get_notes_info",
  "arguments": {
    "paths": ["note1.md", "note2.md"]
  }
}
```

**Response:**
```json
{
  "notes": [
    {
      "path": "note1.md",
      "size": 1024,
      "modified": 1695456000000,
      "hasFrontmatter": true
    }
  ],
  "count": 1
}
```

## Security Considerations

This MCP server implements several security measures to protect your Obsidian vault:

### Path Security
- **Path Traversal Protection:** All file paths are validated to prevent access outside the vault
- **Relative Path Enforcement:** Paths are normalized and restricted to the vault directory
- **Symbolic Link Safety:** Resolved paths are checked against vault boundaries

### File Filtering
- **Automatic Exclusions:** `.obsidian`, `.git`, `node_modules`, and system files are filtered
- **Extension Whitelist:** Only `.md`, `.markdown`, and `.txt` files are accessible by default
- **Hidden File Protection:** Dot files and system directories are automatically excluded

### Content Validation
- **YAML Frontmatter Validation:** Frontmatter is parsed and validated before writing
- **Function/Symbol Prevention:** Dangerous JavaScript objects are blocked from frontmatter
- **Data Type Checking:** Only safe data types (strings, numbers, arrays, objects) allowed

### Best Practices
- **Least Privilege:** Server only accesses the specified vault directory
- **Read-Only by Default:** Consider running with read-only permissions for sensitive vaults
- **Backup Recommended:** Always backup your vault before using write operations
- **Network Isolation:** Server uses stdio transport (no network exposure)

### What's NOT Protected
- **File Content:** The server can read/write any allowed file content
- **Vault Structure:** Directory structure is visible to AI assistants
- **File Metadata:** Creation times, file sizes, etc. are accessible

**⚠️ Important:** Only grant vault access to trusted AI conversations. The server provides full read/write access to your notes within the security boundaries above.

## Architecture

- `server.ts` - MCP server entry point
- `src/frontmatter.ts` - YAML frontmatter handling with gray-matter
- `src/filesystem.ts` - Safe file operations with path validation
- `src/pathfilter.ts` - Directory and file filtering
- `src/types.ts` - TypeScript type definitions

## Contributing

1. Fork the repository
2. Create a feature branch: `git checkout -b feature-name`
3. Make your changes and add tests
4. Ensure all tests pass: `npm test`
5. Submit a pull request

## License

MIT